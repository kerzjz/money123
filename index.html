<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>Money123 by Ker ZJZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- MDUI v1 -->
  <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css">
  <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
</head>

<body class="mdui-theme-primary-indigo mdui-theme-accent-pink">
  <!-- 顶部标题栏 -->
  <header class="mdui-appbar">
    <div class="mdui-toolbar mdui-color-indigo">
      <span class="mdui-typo-title">Money123 by Ker ZJZ</span>
      <div class="mdui-toolbar-spacer"></div>
    </div>
  </header>

  <!-- 标签页 -->
  <div class="mdui-container">
    <div class="mdui-tab mdui-tab-full-width" mdui-tab>
      <a href="#gold" class="mdui-ripple">
        <i class="mdui-icon material-icons">attach_money</i> 实时金价
      </a>
      <a href="#stock" class="mdui-ripple">
        <i class="mdui-icon material-icons">trending_up</i> 股票
      </a>
      <!--<a href="#images" class="mdui-ripple">
        <i class="mdui-icon material-icons">image</i> 图片
      </a>
      <a href="#rss" class="mdui-ripple">
        <i class="mdui-icon material-icons">rss_feed</i> RSS
      </a>-->
      <a href="#calc" class="mdui-ripple">
        <i class="mdui-icon material-icons">calculate</i> 理财计算
      </a>
    </div>
  </div>

  <!-- 内容区 -->
  <div class="mdui-container mdui-p-t-4">

    <!-- 1. 实时金价 -->
    <div id="gold" class="mdui-p-a-2">
      <div class="mdui-card">
        <div class="mdui-card-primary">
          <div class="mdui-card-primary-title">实时黄金价格</div>
          <div class="mdui-card-primary-subtitle" id="goldUpdate">正在获取数据...</div>
        </div>
        <div class="mdui-card-content">
          <div id="goldList" class="mdui-row-xs-1 mdui-row-sm-2 mdui-row-md-3">
            <div class="mdui-col mdui-text-center">
              <div class="mdui-spinner mdui-spinner-colorful"></div>
              <p class="mdui-text-color-theme-text">加载中...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 2.股票（旧）-->
  <!--<style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .result-container {
      margin-top: 20px;
    }
  </style>-->
  <!-- 2.股票 -->
  <!-- 输入框 -->
  <label for="secidInput">请输入股票代码</label>
  <input class="mdui-textfield-input" type="text" id="secidInput" placeholder="例如: 300033">
  <br><br>

  <!-- POST请求按钮 -->
  <button class="mdui-btn mdui-btn-raised mdui-color-indigo" id="postRequestButton">发送POST请求</button>
  <br><br>

  <!-- GET请求按钮 -->
  <button class="mdui-btn mdui-btn-raised mdui-color-indigo" id="getRequestButton">发送GET请求</button>
  <br><br>

  <!-- 显示返回数据的区域 -->
  <div id="result" class="result-container"></div>

    <!-- 2. 股票（表格版）
<div id="stock" class="mdui-p-a-2">
  <div class="mdui-textfield mdui-textfield-floating-label">
    <label class="mdui-textfield-label">股票代码</label>
    <input class="mdui-textfield-input" id="secidInput" type="text"/>
    <span class="mdui-textfield-helper">例如：300033</span>
  </div>
  <button id="postBtn" class="mdui-btn mdui-btn-raised mdui-color-indigo mdui-m-r-2">POST 查询</button>
  <button id="getBtn"  class="mdui-btn mdui-btn-raised mdui-color-green">GET 查询</button>

  行情表格
  <div class="mdui-m-t-2">
    <table class="mdui-table mdui-table-hoverable">
      <thead>
        <tr>
          <th>股票代码</th>
          <th>股票名称</th>
          <th>时间</th>
          <th>开盘</th>
          <th>收盘</th>
          <th>最高</th>
          <th>最低</th>
          <th>涨跌幅</th>
          <th>成交量</th>
          <th>成交额</th>
          <th>换手率</th>
          <th>振幅</th>
        </tr>
      </thead>
      <tbody id="stockTbody"></tbody>
    </table>
  </div>
</div>-->

    <!--3. 图片占位
    <div id="images" class="mdui-p-a-2 mdui-text-center">
      <div class="mdui-card">
        <div class="mdui-card-content">图片模块待扩展</div>
      </div>
    </div>

    4. RSS 占位
    <div id="rss" class="mdui-p-a-2 mdui-text-center">
      <div class="mdui-card">
        <div class="mdui-card-content">RSS 模块待扩展</div>
      </div>
    </div>-->

    <!-- 5. 理财计算器 -->
    <div id="calc" class="mdui-p-a-2">
      <div class="mdui-card">
        <div class="mdui-card-primary">
          <div class="mdui-card-primary-title">理财计算器</div>
        </div>
        <div class="mdui-card-content">
          <!-- ① 计算利息 -->
          <h4 class="mdui-text-color-theme">① 计算利息</h4>
          <div class="mdui-textfield">
            <label class="mdui-textfield-label">本金（元）</label>
            <input class="mdui-textfield-input" id="p1" type="number"/>
          </div>
          <div class="mdui-textfield">
            <label class="mdui-textfield-label">七日年化（%）</label>
            <input class="mdui-textfield-input" id="r7" type="number" step="0.01"/>
          </div>
          <div class="mdui-textfield">
            <label class="mdui-textfield-label">持有天数（空=1）</label>
            <input class="mdui-textfield-input" id="days" type="number"/>
          </div>
          <button class="mdui-btn mdui-btn-raised mdui-color-indigo" onclick="calcInterest()">计算利息</button>
          <div id="intRes" class="mdui-m-t-1 mdui-typo-title"></div>

          <!-- ② 反算七日年化 -->
          <h4 class="mdui-text-color-theme mdui-m-t-3">② 反算七日年化</h4>
          <div class="mdui-textfield">
            <label class="mdui-textfield-label">本金（元）</label>
            <input class="mdui-textfield-input" id="p2" type="number"/>
          </div>
          <div class="mdui-textfield">
            <label class="mdui-textfield-label">七日总收益（元）</label>
            <input class="mdui-textfield-input" id="earn7" type="number" step="0.01"/>
          </div>
          <button class="mdui-btn mdui-btn-raised mdui-color-green" onclick="calcAPR()">计算七日年化</button>
          <div id="aprRes" class="mdui-m-t-1 mdui-typo-title"></div>
        </div>
      </div>
    </div>

  </div>

  <script>
    /* ========== 实时金价 ========== */
    fetch('https://api.pearktrue.cn/api/goldprice/')
      .then(r => r.json())
      .then(d => {
        if (d.code === 200) {
          const wrap = document.getElementById('goldList');
          wrap.className = 'mdui-row-xs-1 mdui-row-sm-2 mdui-row-md-3';
          wrap.innerHTML = d.data.map(item => `
            <div class="mdui-col mdui-m-b-2">
              <div class="mdui-card">
                <div class="mdui-card-primary">
                  <div class="mdui-card-primary-title">${item.title}</div>
                </div>
                <div class="mdui-card-content">
                  <!--<div class="mdui-typo-display-1 mdui-text-color-theme">${item.price}</div>-->
                  <div class="mdui-chip ${item.changepercent.startsWith('+')?'mdui-color-red':'mdui-color-green'} mdui-m-t-1">
                    <span class="mdui-chip-title">${item.changepercent}</span>
                  </div>
                  <div class="mdui-text-color-theme-secondary mdui-m-t-1">
                    最高：${item.maxprice} &nbsp; 最低：${item.minprice} &nbsp; 最高买入价：${item.buyprice} &nbsp; 最低卖出价：${item.recycleprice}; 
                  </div>
                </div>
              </div>
            </div>`).join('');
          document.getElementById('goldUpdate').textContent = `更新时间：${d.time}`;
        }
      });

    /* * ========== 股票（表格渲染） ========== 
const postBtn = document.getElementById('postBtn');
const getBtn  = document.getElementById('getBtn');
const tbody   = document.getElementById('stockTbody');
const secInp  = document.getElementById('secidInput');

/ 把任意值转成字符串 
function fmt(v) {
  if (v === null || v === undefined) return '';
  if (typeof v === 'object') {
    if (Array.isArray(v)) return v.map(fmt).join(', ');
    return Object.keys(v).map(k => `${k}: ${fmt(v[k])}`).join('; ');
  }
  return String(v);
}

/* 渲染表格 
function renderTable(res) {
  const raw = Array.isArray(res.data) ? res.data : [res.data];
  /* 修正字段映射 
const map = {
  secid: '股票代码',
  name: '股票名称',
  time: '时间',
  opening: '开盘',
  closing: '收盘',
  highest: '最高',
  lowest: '最低',
  inorde: '涨跌幅',
  trading_volume: '成交量',
  turnover: '成交额',
  turnover_rate: '换手率',
  amplitude: '振幅'
};

/* 渲染时也用新字段名
tbody.innerHTML = raw.map(obj => `
  <tr>
    <td>${fmt(obj.secid)}</td>
    <td>${fmt(obj.name)}</td>
    <td>${fmt(obj.time)}</td>
    <td>${fmt(obj.opening)}</td>
    <td>${fmt(obj.closing)}</td>
    <td>${fmt(obj.highest)}</td>
    <td>${fmt(obj.lowest)}</td>
    <td>${fmt(obj.inorde)}</td>
    <td>${fmt(obj.trading_volume)}</td>
    <td>${fmt(obj.turnover)}</td>
    <td>${fmt(obj.turnover_rate)}</td>
    <td>${fmt(obj.amplitude)}</td>
  </tr>`).join('');
}

/* 绑定按钮 
postBtn.onclick = () => {
  const v = secInp.value.trim();
  if (!v) return mdui.snackbar({ message: '请输入股票代码' });
  fetch('https://api.pearktrue.cn/api/stock/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ secid: v, num: '30' })
  })
    .then(r => r.json())
    .then(renderTable)
    .catch(e => tbody.innerHTML = `<tr><td colspan="12" class="mdui-text-color-red">请求失败：${e}</td></tr>`);
};

getBtn.onclick = () => {
  const v = secInp.value.trim();
  if (!v) return mdui.snackbar({ message: '请输入股票代码' });
  fetch(`https://api.pearktrue.cn/api/stock/?secid=${v}&num=100`)
    .then(r => r.json())
    .then(renderTable)
    .catch(e => tbody.innerHTML = `<tr><td colspan="12" class="mdui-text-color-red">请求失败：${e}</td></tr>`);
}; */

  /*  ========== 股票（表格渲染） ========== */
    // 获取按钮和显示结果的元素
    const postButton = document.getElementById('postRequestButton');
    const getButton = document.getElementById('getRequestButton');
    const resultDiv = document.getElementById('result');
    const secidInput = document.getElementById('secidInput');

    // 清空结果区域
    function clearResult() {
      resultDiv.innerHTML = '';
    }

    // 映射键到描述性内容
    const keyMappings = {
      secid: '股票代码',
      num: '数量',
      name: '股票名称',
      opening: '开盘',
      closing: '收盘',
      lowest: '最低',
      trading_volume: '成交量',
      turnover: '成交额',
      amplitude: '振幅',
      inorde: '涨跌幅',
      inorde_amount: '涨跌额',
      turnover_rate: '换手率',
      code: '__HIDDEN__', // 隐藏code字段
      msg: '__HIDDEN__', // 隐藏msg字段
      time: '时间', 
      highest: '最高', 
      data: ' ', 
      api_source: '__HIDDEN__', 
      // 可以继续添加其他键的映射
    };

    // 检查是否应该隐藏键
    function shouldHideKey(key) {
      return keyMappings[key] === '__HIDDEN__';
    }

    // 格式化显示数据
    function displayData(data) {
      clearResult();
      if (Array.isArray(data)) {
        // 如果是数组，显示为表格
        const table = document.createElement('table');
        const headerRow = document.createElement('tr');
        const keys = Object.keys(data[0]).filter(key => !shouldHideKey(key));
        keys.forEach(key => {
          const th = document.createElement('th');
          th.textContent = keyMappings[key] || key; // 使用映射或原始键
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);
        data.forEach(item => {
          const row = document.createElement('tr');
          keys.forEach(key => {
            const cell = document.createElement('td');
            if (typeof item[key] === 'object') {
              // 如果值是对象，递归显示
              cell.appendChild(displayData(item[key]));
            } else {
              cell.textContent = item[key];
            }
            row.appendChild(cell);
          });
          table.appendChild(row);
        });
        return table;
      } else if (typeof data === 'object') {
        // 如果是对象，显示为表格
        const table = document.createElement('table');
        const headerRow = document.createElement('tr');
        const th = document.createElement('th');
        th.textContent = '字段'; // 修改Key列的显示内容
        headerRow.appendChild(th);
        const th2 = document.createElement('th');
        th2.textContent = '值'; // 修改Value列的显示内容
        headerRow.appendChild(th2);
        table.appendChild(headerRow);
        Object.keys(data).filter(key => !shouldHideKey(key)).forEach(key => {
          const row = document.createElement('tr');
          const cell1 = document.createElement('td');
          cell1.textContent = keyMappings[key] || key; // 使用映射或原始键
          row.appendChild(cell1);
          const cell2 = document.createElement('td');
          if (typeof data[key] === 'object') {
            // 如果值是对象，递归显示
            cell2.appendChild(displayData(data[key]));
          } else {
            cell2.textContent = JSON.stringify(data[key], null, 2);
          }
          row.appendChild(cell2);
          table.appendChild(row);
        });
        return table;
      } else {
        // 其他类型直接显示
        const text = document.createElement('p');
        text.textContent = data;
        return text;
      }
    }

    // 使用Fetch API发送POST请求
    postButton.addEventListener('click', () => {
      const secid = secidInput.value.trim();
      if (!secid) {
        alert('请输入股票代码！');
        return;
      }
      fetch('https://api.pearktrue.cn/api/stock/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          secid: secid,
          num: '100'
        }),
      })
      .then(response => response.json())
      .then(data => {
        resultDiv.appendChild(displayData(data));
      })
      .catch((error) => {
        console.error('Error:', error);
        clearResult();
        const errorText = document.createElement('p');
        errorText.style.color = 'red';
        errorText.textContent = `请求失败: ${error}`;
        resultDiv.appendChild(errorText);
      });
    });

    // 使用Fetch API发送GET请求
    getButton.addEventListener('click', () => {
      const secid = secidInput.value.trim();
      if (!secid) {
        alert('请输入股票代码！');
        return;
      }
      fetch(`https://api.pearktrue.cn/api/stock/?secid=${secid}&num=100`, {
        method: 'GET',
      })
      .then(response => response.json())
      .then(data => {
        resultDiv.appendChild(displayData(data));
      })
      .catch((error) => {
        console.error('Error:', error);
        clearResult();
        const errorText = document.createElement('p');
        errorText.style.color = 'red';
        errorText.textContent = `请求失败: ${error}`;
        resultDiv.appendChild(errorText);
      });
    });

    
    /* ========== 理财计算 ========== */
    function calcInterest() {
      const p = Number(document.getElementById('p1').value);
      const r = Number(document.getElementById('r7').value);
      const d = Number(document.getElementById('days').value) || 1;
      if (!p || !r) return mdui.snackbar({ message: '请填写完整' });
      const interest = (p * r / 100 / 365 * d).toFixed(2);
      document.getElementById('intRes').textContent = `${d} 天收益：${interest} 元`;
    }
    function calcAPR() {
      const p = Number(document.getElementById('p2').value);
      const e = Number(document.getElementById('earn7').value);
      if (!p || !e) return mdui.snackbar({ message: '请填写完整' });
      const apr = (e / p * 365 / 7 * 100).toFixed(2);
      document.getElementById('aprRes').textContent = `七日年化：${apr} %`;
    }
  </script>
</body>
</html>






